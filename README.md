# A股策略回测系统

一个功能强大的A股策略回测系统，支持自定义策略条件，自动筛选符合条件的股票。

## 功能特点

- ✅ 自定义策略条件（涨停、涨幅、成交量比例等）
- ✅ 自动排除科创板、创业板、北交所、ST股、退市股
- ✅ 近一个月（可自定义）数据回测
- ✅ 美观的Web界面
- ✅ 实时数据获取（使用akshare）

## 安装步骤

### 1. 创建虚拟环境（推荐）

```bash
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# 或
venv\Scripts\activate  # Windows
```

### 2. 安装Python依赖

```bash
pip install -r requirements.txt
```

### 3. 运行应用

```bash
python app.py
```

或者使用启动脚本（会自动创建虚拟环境并安装依赖）：

```bash
./run.sh
```

### 3. 访问系统

打开浏览器访问：http://localhost:8086

**注意**: 如果遇到 `ModuleNotFoundError` 错误，请确保已激活虚拟环境：
```bash
source venv/bin/activate
```

## 使用说明

### 策略配置

系统支持以下策略条件类型：

1. **涨停**：判断指定日期是否涨停（涨幅≥9.8%）
2. **涨幅大于**：判断指定日期涨幅是否大于指定值
3. **涨幅小于**：判断指定日期涨幅是否小于指定值
4. **成交量比例**：判断两个日期的成交量比例关系

### 示例策略

用户示例策略：
- 1月07日涨停（日期偏移：0天）
- 1月08日涨幅大于零（日期偏移：1天）
- 1月09日涨幅小于零（日期偏移：2天）
- 1月08日成交量/1月09日成交量>1（日期1偏移：1天，日期2偏移：2天）
- 1月12日成交量/1月09日成交量>1（日期1偏移：5天，日期2偏移：2天）
- 1月12日涨幅大于零（日期偏移：5天）

点击"加载示例策略"按钮可以快速加载上述策略。

### 日期偏移说明

- 日期偏移是指相对于基准日期（策略匹配的起始日期）的天数
- 例如：如果基准日期是1月7日，那么偏移0天就是1月7日，偏移1天就是1月8日

## 项目结构

```
量化/
├── app.py                 # Flask主应用
├── data_fetcher.py        # 数据获取模块
├── strategy_engine.py     # 策略回测引擎
├── requirements.txt       # Python依赖
├── templates/
│   └── index.html        # 前端页面
└── static/
    ├── css/
    │   └── style.css     # 样式文件
    └── js/
        └── app.js        # 前端逻辑
```

## 技术栈

- **后端**：Flask (Python)
- **前端**：HTML + CSS + JavaScript
- **数据源**：akshare（免费A股数据接口）

## 注意事项

1. 首次运行需要下载股票列表，可能需要一些时间
2. 回测过程会遍历所有符合条件的股票，可能需要几分钟时间
3. 数据来源于akshare，请确保网络连接正常
4. 涨停判断标准：涨幅≥9.8%（考虑数据精度误差）
5. **代理问题**：如果遇到代理连接错误，系统已自动禁用代理。如果仍有问题，请检查网络设置
6. **数据获取**：系统已添加重试机制和请求延迟，避免请求过快导致失败

## 测试数据获取

### 方法1: 使用启动脚本（推荐）

```bash
# 运行获取今天数据的示例
./run_test.sh today

# 运行数据获取测试
./run_test.sh data
```

### 方法2: 手动激活虚拟环境

```bash
# 必须先激活虚拟环境！
source venv/bin/activate

# 然后运行脚本
python3 test_data.py

# 或运行获取今天数据的示例
python3 get_today_simple.py
```

**重要提示**: 如果不激活虚拟环境，会出现 `ModuleNotFoundError: No module named 'akshare'` 错误！

## 常见问题

**Q: 为什么回测结果为空？**
A: 可能原因：
- 策略条件过于严格
- 时间范围内没有符合条件的股票
- 数据获取失败（检查网络连接）

**Q: 如何提高回测速度？**
A: 可以：
- 减少回测时间范围
- 减少策略条件数量
- 优化网络连接

## 许可证

MIT License
# -
